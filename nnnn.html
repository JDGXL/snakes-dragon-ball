<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Snake Dragon Ball</title>
<style>
  body { margin:0; background:black; overflow:hidden; color:white; text-align:center; font-family:Arial; }
  canvas { background:url('https://i.imgur.com/qxB8R1F.png'); background-size:cover; display:block; margin:auto; }
  #overlay { position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.7); color:white; display:flex; align-items:center; justify-content:center; font-size:24px; visibility:hidden; }
</style>
</head>
<body>
<canvas id="game" width="480" height="480"></canvas>
<div id="overlay"></div>

<script>
// ==== CONFIGURACIÃ“N ====
const CELL=24;
const COLS=20, ROWS=20;
const ctx=document.getElementById('game').getContext('2d');
let snake=[{x:10,y:10}];
let dir={x:0,y:0};
let nextDir={x:0,y:0};
let foodList=[];
let level=1;
let running=false;
let boardExpanded=false;
let teleportSound=new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg");

// ==== INICIO ====
spawnFood();
draw();
document.addEventListener('keydown',e=>{
  if(!running) return;

  // ðŸ”’ Evitar scroll con flechas
  if(['ArrowUp','ArrowDown','ArrowLeft','ArrowRight'].includes(e.key)){
    e.preventDefault();
  }

  if((e.key==='ArrowUp'||e.key==='w')&&dir.y!==1) nextDir={x:0,y:-1};
  if((e.key==='ArrowDown'||e.key==='s')&&dir.y!==-1) nextDir={x:0,y:1};
  if((e.key==='ArrowLeft'||e.key==='a')&&dir.x!==1) nextDir={x:-1,y:0};
  if((e.key==='ArrowRight'||e.key==='d')&&dir.x!==-1) nextDir={x:1,y:0};
  if(e.key===' '&&!running) startGame();
});

function startGame(){
  snake=[{x:10,y:10}];
  dir={x:1,y:0};
  nextDir={x:1,y:0};
  running=true;
  gameTick();
}

function spawnFood(){
  foodList=[];
  for(let i=0;i<7;i++){
    foodList.push({
      x:Math.floor(Math.random()*COLS),
      y:Math.floor(Math.random()*ROWS),
      stars:i+1
    });
  }
}

function drawDragonBall(x,y,stars){
  const colors=['#ffa500','#ffbf00','#ffcc00'];
  ctx.fillStyle=colors[stars%3];
  ctx.beginPath();
  ctx.arc(x+CELL/2,y+CELL/2,CELL/2.2,0,Math.PI*2);
  ctx.fill();
  ctx.fillStyle='red';
  for(let i=0;i<stars;i++){
    const angle=i*(Math.PI*2/stars);
    ctx.beginPath();
    ctx.arc(x+CELL/2+Math.cos(angle)*6,y+CELL/2+Math.sin(angle)*6,2,0,Math.PI*2);
    ctx.fill();
  }
}

function draw(){
  ctx.clearRect(0,0,480,480);
  for(const f of foodList){ drawDragonBall(f.x*CELL,f.y*CELL,f.stars); }
  ctx.fillStyle='lime';
  for(const s of snake){ ctx.fillRect(s.x*CELL,s.y*CELL,CELL-2,CELL-2); }
}

function showOverlay(msg,time=1500){
  const o=document.getElementById('overlay');
  o.textContent=msg;
  o.style.visibility='visible';
  setTimeout(()=>o.style.visibility='hidden',time);
}

function teleportToCenter(){
  snake[0].x=Math.floor(COLS/2);
  snake[0].y=Math.floor(ROWS/2);
}

function showEpicDragonBallsAnimation(callback){
  const hx = snake[0].x*CELL + CELL/2;
  const hy = snake[0].y*CELL + CELL/2;
  const colors = ['#ffd700','#ffec8b','#fffacd'];
  let particles = [];

  // Crear partÃ­culas doradas
  for(let i=0;i<100;i++){
      particles.push({
          x:hx, y:hy,
          vx:(Math.random()-0.5)*5,
          vy:(Math.random()-0.5)*5,
          alpha:1,
          color: colors[Math.floor(Math.random()*colors.length)],
          size: Math.random()*5+2
      });
  }

  let frames = 0;
  function animate(){
      frames++;
      draw(); // dibuja el juego normalmente

      // bolas brillando
      for(const f of foodList){
          const cx = f.x*CELL + CELL/2;
          const cy = f.y*CELL + CELL/2;
          const pulse = Math.sin(frames/5)*0.3 + 1;
          ctx.save();
          ctx.translate(cx,cy);
          ctx.scale(pulse,pulse);
          drawDragonBall(-CELL/2,-CELL/2,f.stars);
          ctx.restore();
      }

      // partÃ­culas
      for(const p of particles){
          p.x += p.vx; p.y += p.vy;
          p.alpha -= 0.03;
          ctx.fillStyle = p.color;
          ctx.globalAlpha = Math.max(p.alpha,0);
          ctx.beginPath();
          ctx.arc(p.x,p.y,p.size,0,Math.PI*2);
          ctx.fill();
      }
      ctx.globalAlpha = 1;

      if(frames<60) requestAnimationFrame(animate);
      else callback();
  }
  animate();
}

function gameTick(){
  if(!running) return;
  dir=nextDir;
  const head={x:snake[0].x+dir.x,y:snake[0].y+dir.y};

  // colisiones
  if(head.x<0||head.x>=COLS||head.y<0||head.y>=ROWS){
    running=false; showOverlay("Game Over"); return;
  }

  snake.unshift(head);

  const foodIndex=foodList.findIndex(f=>f.x===head.x&&f.y===head.y);
  if(foodIndex!==-1){
    foodList.splice(foodIndex,1);
    if(foodList.length===0){
      if(level===1){
          // âš¡ animaciÃ³n al reunir las 7 bolas
          showEpicDragonBallsAnimation(()=>{
              showOverlay("Â¡Has reunido las 7 Bolas del DragÃ³n!\nShenlong te teletransporta...",1800);
              teleportToCenter();
              level=2;
              spawnFood();
              teleportSound.currentTime=0;
              teleportSound.play();
          });
      } else spawnFood();
    }
  } else snake.pop();

  draw();
  setTimeout(gameTick,150);
}
</script>
</body>
</html>
